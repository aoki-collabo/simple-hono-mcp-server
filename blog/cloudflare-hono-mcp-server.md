# Cloudflare + Honoã§ä½œã‚‹æœ€é€Ÿãƒªãƒ¢ãƒ¼ãƒˆMCPã‚µãƒ¼ãƒãƒ¼

ãƒªãƒ¢ãƒ¼ãƒˆMCPã‚µãƒ¼ãƒãƒ¼ã€æ€ã£ãŸã‚ˆã‚Šç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚
ã“ã®è¨˜äº‹ã§ã¯ã€Cloudflare Workersã¨Honoã‚’ä½¿ã£ã¦ã€5åˆ†ã§MCPã‚µãƒ¼ãƒãƒ¼ã‚’å…¬é–‹ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ãªãœ Cloudflare + Honoï¼Ÿ

| æŠ€è¡“ | ãƒ¡ãƒªãƒƒãƒˆ |
|------|----------|
| **Cloudflare Workers** | ç„¡æ–™æ ã§ååˆ†ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«1ã¤ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã€ä¸–ç•Œä¸­ã®ã‚¨ãƒƒã‚¸ã§é«˜é€Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ |
| **Hono** | è»½é‡ãƒ»é«˜é€Ÿã€Cloudflareæœ€é©åŒ–æ¸ˆã¿ã€`@hono/mcp`ã§MCPå¯¾å¿œãŒç°¡å˜ |

ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ä¸è¦ã€ã‚³ãƒãƒ³ãƒ‰1ã¤ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚å€‹äººé–‹ç™ºã«æœ€é©ãªçµ„ã¿åˆã‚ã›ã§ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

Claude Desktopãªã©ã®MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã€Streamable HTTPçµŒç”±ã§Cloudflare Workersä¸Šã®ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šãã¾ã™ã€‚

ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã¯3å±¤æ§‹æˆ:
1. **Hono** - HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
2. **@hono/mcp** - MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’å‡¦ç†ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
3. **factorizeãƒ„ãƒ¼ãƒ«** - å®Ÿéš›ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç´ å› æ•°åˆ†è§£ï¼‰

ãŸã£ãŸ1ãƒ•ã‚¡ã‚¤ãƒ«ã€ç´„50è¡Œã§å®Œçµã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã§ã™ã€‚

ï¼ˆå›³ï¼‰

<!--
ğŸ“Š å›³1: ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

â–  å›³ä½œæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:
æŠ€è¡“ãƒ–ãƒ­ã‚°ç”¨ã®ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€æ§‹æˆè¦ç´ ã€‘
- å·¦å´: ã€ŒClaude Desktopã€ï¼ˆPCã‚¢ã‚¤ã‚³ãƒ³ã¾ãŸã¯ãƒãƒ£ãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- ä¸­å¤®: ã€ŒCloudflare Workersã€ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®é›²ã¾ãŸã¯å…­è§’å½¢ã®ãƒ­ã‚´é¢¨ï¼‰
- ä¸­å¤®ã®å†…éƒ¨ã«3å±¤æ§‹é€ :
  1. Honoï¼ˆç‚ã®ã‚¢ã‚¤ã‚³ãƒ³ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å±¤ï¼‰
  2. @hono/mcpï¼ˆMCPãƒ—ãƒ­ãƒˆã‚³ãƒ«å±¤ï¼‰
  3. factorize ãƒ„ãƒ¼ãƒ«ï¼ˆè¨ˆç®—æ©Ÿã‚¢ã‚¤ã‚³ãƒ³ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ï¼‰
- å·¦ã‹ã‚‰å³ã¸ã€ŒStreamable HTTPã€ã¨æ›¸ã‹ã‚ŒãŸçŸ¢å°ã§æ¥ç¶š

ã€ã‚¹ã‚¿ã‚¤ãƒ«ã€‘
- ãƒ•ãƒ©ãƒƒãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ã€ãƒ¢ãƒ€ãƒ³ãªæŠ€è¡“ãƒ–ãƒ­ã‚°é¢¨
- èƒŒæ™¯: ç™½ã¾ãŸã¯è–„ã„ã‚°ãƒ¬ãƒ¼
- é…è‰²: Cloudflareã‚ªãƒ¬ãƒ³ã‚¸(#F6821F)ã€Honoã®ç‚(#FF6B35)ã‚’ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã«
- è§’ä¸¸ã®å››è§’å½¢ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¾
- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã€ãƒ•ã‚©ãƒ³ãƒˆã¯ã‚´ã‚·ãƒƒã‚¯ä½“
- ã‚µã‚¤ã‚º: æ¨ªé•·ï¼ˆ16:9ç¨‹åº¦ï¼‰ã€ãƒ–ãƒ­ã‚°è¨˜äº‹ã«åŸ‹ã‚è¾¼ã¿ã‚„ã™ã„ã‚µã‚¤ã‚º
-->

## ä½œã‚‹ã‚‚ã®

ç´ å› æ•°åˆ†è§£ãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã™ã‚‹MCPã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚

```
12 â†’ [2, 2, 3]ï¼ˆå‰²ã‚Šç®—3å›ï¼‰
```

## å‰ææ¡ä»¶

- Node.js v18ä»¥ä¸Š
- Cloudflareã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç„¡æ–™ï¼‰

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
mkdir simple-mcp-server && cd simple-mcp-server
npm init -y
npm install hono @hono/mcp @modelcontextprotocol/sdk zod
npm install -D wrangler typescript @cloudflare/workers-types
```

## wrangler.toml

```toml
name = "simple-mcp-server"
main = "src/index.ts"
compatibility_date = "2024-01-01"
```

## tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "strict": true,
    "types": ["@cloudflare/workers-types"]
  },
  "include": ["src/**/*"]
}
```

## src/index.ts

```typescript
import { Hono } from "hono";
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { createMcpHandler } from "@hono/mcp";
import { z } from "zod";

const app = new Hono();

// ç´ å› æ•°åˆ†è§£
function factorize(n: number): { factors: number[]; divisionCount: number } {
  if (n === 1) return { factors: [1], divisionCount: 0 };

  const factors: number[] = [];
  let remaining = n;
  let count = 0;

  while (remaining % 2 === 0) {
    factors.push(2);
    remaining /= 2;
    count++;
  }

  let d = 3;
  while (d * d <= remaining) {
    while (remaining % d === 0) {
      factors.push(d);
      remaining /= d;
      count++;
    }
    d += 2;
  }

  if (remaining > 1) factors.push(remaining);

  return { factors, divisionCount: count };
}

// MCPã‚µãƒ¼ãƒãƒ¼è¨­å®š
const server = new McpServer({ name: "simple-mcp-server", version: "1.0.0" });

server.tool(
  "factorize",
  "æ­£ã®æ•´æ•°ã‚’ç´ å› æ•°åˆ†è§£ã—ã¾ã™",
  { number: z.number().int().min(1).max(999999999999999) },
  async ({ number }) => {
    const { factors, divisionCount } = factorize(number);
    return {
      content: [
        {
          type: "text" as const,
          text: `${number}ã®ç´ å› æ•°åˆ†è§£çµæœ:\nç´ å› æ•°: [${factors.join(", ")}]\nå‰²ã‚Šç®—å›æ•°: ${divisionCount}å›`,
        },
      ],
    };
  }
);

// MCPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
app.all("/mcp", createMcpHandler(server));

export default app;
```

## ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ã‹ã™

```bash
npx wrangler dev
```

`http://localhost:8787/mcp` ã§MCPã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¾ã™ã€‚

## ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
npx wrangler deploy
```

ã“ã‚Œã ã‘ã§ã™ã€‚URLãŒç™ºè¡Œã•ã‚Œã‚‹ã®ã§ã€MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰æ¥ç¶šã§ãã¾ã™ã€‚

ï¼ˆå›³ï¼‰

<!--
ğŸ“Š å›³2: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼å›³

â–  å›³ä½œæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:
æŠ€è¡“ãƒ–ãƒ­ã‚°ç”¨ã®é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼å›³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€æ§‹æˆè¦ç´ ã€‘
- å·¦å´: ã€Œãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã€ï¼ˆãƒãƒ¼ãƒˆPCã‚¢ã‚¤ã‚³ãƒ³ã€ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰
- ä¸­å¤®ã‹ã‚‰2ã¤ã®çŸ¢å°ãŒåˆ†å²:
  - ä¸Šã®çŸ¢å°: ã€Œnpx wrangler devã€ã®ãƒ©ãƒ™ãƒ«ä»˜ã
    â†’ ã€Œlocalhost:8787ã€ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚¢ã‚¤ã‚³ãƒ³ã€é–‹ç™ºä¸­ã‚’ç¤ºã™ç‚¹ç·šã®æ ï¼‰
  - ä¸‹ã®çŸ¢å°: ã€Œnpx wrangler deployã€ã®ãƒ©ãƒ™ãƒ«ä»˜ã
    â†’ ã€ŒCloudflare Edgeã€ï¼ˆä¸–ç•Œåœ°å›³ä¸Šã«è¤‡æ•°ã®ã‚¨ãƒƒã‚¸ã‚µãƒ¼ãƒãƒ¼ã‚’ç¤ºã™ç‚¹ï¼‰
    â†’ ã€Œhttps://xxx.workers.devã€ï¼ˆURLã¨ã‚°ãƒ­ãƒ¼ãƒ–ã‚¢ã‚¤ã‚³ãƒ³ï¼‰

ã€ãƒ•ãƒ­ãƒ¼èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå›³ä¸­ã«å«ã‚ã‚‹ï¼‰ã€‘
- ä¸Šã®ãƒ•ãƒ­ãƒ¼: ã€Œé–‹ç™ºæ™‚ã€
- ä¸‹ã®ãƒ•ãƒ­ãƒ¼: ã€Œæœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã€

ã€ã‚¹ã‚¿ã‚¤ãƒ«ã€‘
- ãƒ•ãƒ©ãƒƒãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ã€ãƒ¢ãƒ€ãƒ³ãªæŠ€è¡“ãƒ–ãƒ­ã‚°é¢¨
- èƒŒæ™¯: ç™½ã¾ãŸã¯è–„ã„ã‚°ãƒ¬ãƒ¼
- é–‹ç™ºãƒ•ãƒ­ãƒ¼ã¯é’ç³»ï¼ˆ#3B82F6ï¼‰ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼ã¯ã‚ªãƒ¬ãƒ³ã‚¸ç³»ï¼ˆ#F6821Fï¼‰ã§è‰²åˆ†ã‘
- çŸ¢å°ã¯å¤ªã‚ã§è¦–èªæ€§ã‚’é«˜ã
- æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ã€ãƒ•ã‚©ãƒ³ãƒˆã¯ã‚´ã‚·ãƒƒã‚¯ä½“
- ã‚µã‚¤ã‚º: æ¨ªé•·ï¼ˆ16:9ç¨‹åº¦ï¼‰
-->

## Claude Desktopã‹ã‚‰æ¥ç¶š

`~/Library/Application Support/Claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "simple-mcp-server": {
      "url": "https://your-worker.your-subdomain.workers.dev/mcp"
    }
  }
}
```

ï¼ˆå›³ï¼‰

<!--
ğŸ“Š å›³3: å‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆãƒãƒ£ãƒƒãƒˆUIï¼‰

â–  å›³ä½œæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:
æŠ€è¡“ãƒ–ãƒ­ã‚°ç”¨ã®ãƒãƒ£ãƒƒãƒˆUIå‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸å›³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ã€ç”»é¢æ§‹æˆã€‘
Claude Desktopã®ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’æ¨¡ã—ãŸãƒ¢ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€‚ä»¥ä¸‹ã®ä¼šè©±ã‚’è¡¨ç¤º:

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå³å¯„ã›ã€è–„ã„é’ã®å¹ãå‡ºã—ï¼‰:
   ã€Œ12ã‚’ç´ å› æ•°åˆ†è§£ã—ã¦ã€

2. AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå·¦å¯„ã›ã€è–„ã„ã‚°ãƒ¬ãƒ¼ã®å¹ãå‡ºã—ï¼‰:
   ã€Œfactorizeãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™...ã€

3. ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œçµæœï¼ˆAIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã€ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯é¢¨ã®æ ï¼‰:
   ```
   12ã®ç´ å› æ•°åˆ†è§£çµæœ:
   ç´ å› æ•°: [2, 2, 3]
   å‰²ã‚Šç®—å›æ•°: 3å›
   ```

4. AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¶šã:
   ã€Œ12ã¯ 2Ã—2Ã—3 ã«åˆ†è§£ã•ã‚Œã¾ã—ãŸã€‚ã€

ã€UIè¦ç´ ã€‘
- ç”»é¢ä¸Šéƒ¨: ã€ŒClaudeã€ã®ãƒ­ã‚´ã¾ãŸã¯ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼
- ç”»é¢ä¸‹éƒ¨: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›æ¬„ï¼ˆã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
- ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã‚’ç¤ºã™ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆæ­¯è»Šã¾ãŸã¯å·¥å…·ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã‚’2ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ä»˜ã‘ã‚‹

ã€ã‚¹ã‚¿ã‚¤ãƒ«ã€‘
- macOSã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é¢¨ï¼ˆå·¦ä¸Šã«èµ¤é»„ç·‘ã®ä¸¸ãƒœã‚¿ãƒ³ï¼‰
- èƒŒæ™¯: ç™½
- å¹ãå‡ºã—: è§’ä¸¸ã€å½±ä»˜ã
- ãƒ•ã‚©ãƒ³ãƒˆ: ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆé¢¨ã€æ—¥æœ¬èª
- ã‚µã‚¤ã‚º: ç¸¦é•·ï¼ˆ9:16ç¨‹åº¦ï¼‰ã¾ãŸã¯æ­£æ–¹å½¢ã€ã‚¹ãƒãƒ›ç”»é¢ã‚’æ„è­˜
-->

## ã¾ã¨ã‚

- Cloudflare Workers + Hono + @hono/mcp ã§æœ€å°æ§‹æˆã®MCPã‚µãƒ¼ãƒãƒ¼
- èªè¨¼ãªã—ã®ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆï¼ˆæœ¬ç•ªã§ã¯èªè¨¼ã‚’è¿½åŠ æ¨å¥¨ï¼‰
- ç„¡æ–™æ ã§ååˆ†å‹•ä½œ

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸

ã“ã®å®Ÿè£…ã¯ã‚ãˆã¦ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã“ã‹ã‚‰ç™ºå±•ã•ã›ã¦ã€ã‚ãªãŸã ã‘ã®MCPã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã£ã¦ã¿ã¦ãã ã•ã„ã€‚

**ç™ºå±•ã‚¢ã‚¤ãƒ‡ã‚¢:**

| ã‚„ã‚ŠãŸã„ã“ã¨ | å®Ÿè£…ã®ãƒ’ãƒ³ãƒˆ |
|-------------|-------------|
| èªè¨¼ã‚’è¿½åŠ  | Honoã®`bearerAuth`ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€ã¾ãŸã¯Cloudflare Access |
| ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ | Cloudflare KVã€D1ï¼ˆSQLiteï¼‰ã€R2ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰ |
| å¤–éƒ¨APIã¨é€£æº | å¤©æ°—APIã€ç¿»è¨³APIã€ãƒ‹ãƒ¥ãƒ¼ã‚¹APIãªã©ã‚’å‘¼ã³å‡ºã™ãƒ„ãƒ¼ãƒ« |
| è¤‡æ•°ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ  | ãƒ•ã‚£ãƒœãƒŠãƒƒãƒã€ç´ æ•°åˆ¤å®šã€å˜ä½å¤‰æ›ãªã© |

MCPã‚µãƒ¼ãƒãƒ¼ã¯ã€ŒAIã«æ–°ã—ã„èƒ½åŠ›ã‚’ä¸ãˆã‚‹ã€ä»•çµ„ã¿ã§ã™ã€‚
è‡ªåˆ†ã®æ¥­å‹™ã‚„ãƒ›ãƒ“ãƒ¼ã«åˆã‚ã›ãŸãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚Œã°ã€ClaudeãŒã‚ãªãŸå°‚ç”¨ã®ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚

ãƒªãƒã‚¸ãƒˆãƒª: [GitHub](https://github.com/your-username/simple-mcp-server)
